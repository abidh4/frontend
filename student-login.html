<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Login - Comilla University</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="student-login-style.css">
</head>
<body>
        <form class="login-container" id="loginForm" autocomplete="off">
        <button type="button" class="back-btn" onclick="window.location.href='index.html'">&larr; Back</button>
        <div class="login-title">Student Login</div>
        <div class="warning" id="warningMsg">There is an error, try again.</div>
        <label for="hall">Select Hall</label>
        <select id="hall" name="hall" required>
            <option value="">Select Your Hall</option>
            <option value="Bijoy-24 Hall">Bijoy-24 Hall</option>
            <option value="Datta Hall">Datta Hall</option>
            <option value="Nazrul Hall">Nazrul Hall</option>
            <option value="Foyzunnesa Hall">Foyzunnesa Hall</option>
            <option value="Shuniti Shanti Hall">Shuniti Shanti Hall</option>
        </select>
        <label for="roll">Roll</label>
        <input type="text" id="roll" name="roll" required autocomplete="username" placeholder="Roll Number must be of minimum 8 digits" maxlength="8" pattern="\d{8}">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required autocomplete="current-password" placeholder="Enter your password">
        <div style="margin-bottom: 1rem;">
            <input type="checkbox" id="showPassword" style="margin-right: 6px;">
            <label for="showPassword" style="font-size:0.98rem; color:#005892; cursor:pointer;">Show Password</label>
        </div>
        <div class="button-row">
            <button type="submit" class="submit-btn">Submit</button>
            <button type="button" class="clear-btn" id="clearBtn">Clear</button>
        </div>
    </form>
    <script>
        const loginForm = document.getElementById('loginForm');
        const warningMsg = document.getElementById('warningMsg');
        const clearBtn = document.getElementById('clearBtn');
        const rollInput = document.getElementById('roll');
        const passwordInput = document.getElementById('password');
        const showPassword = document.getElementById('showPassword');

        // Show/hide password functionality
        showPassword.addEventListener('change', function() {
            passwordInput.type = this.checked ? 'text' : 'password';
        });

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            warningMsg.style.display = "none";

            const hall = loginForm.hall.value.trim();
            const roll = rollInput.value.trim();
            const password = passwordInput.value;

            // Validate roll: must be 8 digits and numeric
            if (!/^\d{8}$/.test(roll)) {
                warningMsg.textContent = "Roll number must be exactly 8 digits.";
                warningMsg.style.display = "block";
                setTimeout(() => {
                    warningMsg.style.display = "none";
                }, 5000);
                rollInput.value = "";
                rollInput.focus();
                return;
            }

            // Example API endpoint
            const apiUrl = '/api/student-login';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ hall, roll, password })
                });

                if (response.redirected) {
                    window.location.href = response.url;
                    return;
                }

                const data = await response.json();

                if (data.success) {
                    window.location.href = data.redirect || '/student-dashboard.html';
                } else {
                    throw new Error();
                }
            } catch {
                loginForm.reset();
                warningMsg.textContent = "There is an error, try again.";
                warningMsg.style.display = "block";
                setTimeout(() => {
                    warningMsg.style.display = "none";
                }, 5000);
            }
        });

        clearBtn.addEventListener('click', function() {
            loginForm.reset();
            warningMsg.style.display = "none";
        });
    </script>
</body>